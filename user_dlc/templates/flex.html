<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>è‡ªèµ°è»Šæ§åˆ¶ä»‹é¢ </title>
    <style>
        body { font-family: Arial; text-align: center; margin-top: 80px; }
        h1 { margin-bottom: 40px; }
        button, .btn {
            font-size: 24px;
            padding: 20px 40px;
            margin: 20px;
            border-radius: 10px;
            cursor: pointer;
            border: none;
            color: #fff;
            text-decoration: none;
            display: inline-block;
        }
        .pause { background-color: #f39c12; }
        .start { background-color: #2ecc71; }
        .stop  { background-color: #e74c3c; }

        /* è¿”å›æŒ‰éˆ• */
        .back {
            position: fixed;
            top: 16px;
            left: 16px;
            padding: 10px 16px;
            font-size: 16px;
            border-radius: 8px;
            background-color: #607d8b; /* é‹¼è—ç° */
        }
        .back:hover { opacity: .9; }

        #status {
            margin-top: 30px;
            font-size: 20px;
            color: #333;
            white-space: pre-line;
        }
.btn.logout {
  position: fixed;
  top: 16px;
  right: 16px;
  background-color: #e74c3c; /* ç™»å‡ºç”¨ç´…è‰² */
}
    </style>
</head>
<body>
    <!-- è¿”å›åŠŸèƒ½é  -->
    <a class="btn logout" href="/logout?page=dashboard">ç™»å‡º</a>

    <h1>è‡ªèµ°è»Šå°èˆªæ§åˆ¶é¢æ¿</h1>

    <button class="pause" onclick="sendCommand('pause')">ğŸ”´ æš«åœ</button>
    <button class="start" onclick="sendCommand('start')">ğŸŸ¢ å•Ÿå‹•</button>
    <button class="stop"  onclick="sendCommand('stop')">âš« çµæŸ</button>

    <p id="status">ğŸŸ¡ ç­‰å¾…æ“ä½œ...</p>

    <script>
        const PN61_IP = "{{ pn61_ip }}";
        const PI_IP = "{{ pi_ip }}";

        // å°æ‡‰ç‡ˆè™Ÿï¼špause=R, start=G, stop=B
        const commandMap = {
            pause: {toPn61: "pause", toPi: "R"},
            start: {toPn61: "start", toPi: "B"},
            stop:  {toPn61: "stop",  toPi: "G"}
        };

        function sendCommand(cmd) {
            const m = commandMap[cmd];
            const statusEl = document.getElementById("status");
            if (!m) {
                statusEl.textContent = "âŒ ç„¡æ•ˆçš„å‘½ä»¤";
                return;
            }

            // 1) èµ°å¾Œç«¯ä»£ç†å‘¼å« PN61ï¼ˆé¿å… CORSï¼‰
            const pn61 = fetch(`/pn61/${m.toPn61}`, { method: "POST" })
              .then(r => r.text().then(t => ({ ok: r.ok, text: t })));

            // 2) é€ç‡ˆè™Ÿåˆ°æ¨¹è“æ´¾
            const pi = fetch(`/run`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    hosts: { [PI_IP]: m.toPi } // å¤šå°å¯æ”¾å¤šå€‹ key:value
                })
            }).then(r => r.json());

            Promise.all([pn61, pi]).then(([pn61Res, piRes]) => {
                const a = pn61Res.ok ? `PN61: ${pn61Res.text || 'OK'}` : `PN61å¤±æ•—: ${pn61Res.text}`;
                const b = `Pi: ${JSON.stringify(piRes)}`;
                statusEl.textContent = `âœ… å·²é€å‡º\n${a}\n${b}`;
            }).catch(e => {
                statusEl.textContent = `âŒ éŒ¯èª¤ï¼š${e.message}`;
            });
        }
    </script>
</body>
</html>
